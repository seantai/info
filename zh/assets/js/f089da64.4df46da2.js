(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[408],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return h},kt:function(){return p}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function a(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function c(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),l=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):a(a({},t),e)),n},h=function(e){var t=l(e.components);return r.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,h=c(e,["components","mdxType","originalType","parentName"]),d=l(n),p=o,m=d["".concat(s,".").concat(p)]||d[p]||u[p]||i;return n?r.createElement(m,a(a({ref:t},h),{},{components:n})):r.createElement(m,a({ref:t},h))}));function p(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,a=new Array(i);a[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:o,a[1]=c;for(var l=2;l<i;l++)a[l]=n[l];return r.createElement.apply(null,a)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},3878:function(e,t,n){"use strict";n.d(t,{r:function(){return a}});var r=n(7294),o="icon_1PGw",i=n(9205),a=function(e){return r.createElement("div",{className:"alert alert--primary",role:"alert",style:{margin:"2rem"}},r.createElement("div",{className:o},r.createElement(i.A,{icon:"\ud83d\udca1",active:"true"})),e.children)}},983:function(e,t,n){"use strict";n.d(t,{M:function(){return c}});var r=n(7294),o=n(9205),i="titleOffset_2I3u",a="iconContainer_1xRA",c=function(e){var t=e.title?r.createElement("div",{className:"card__header"},r.createElement("span",{className:a},e.icon&&r.createElement(o.A,{icon:e.icon,link:e.link,active:"true"})),r.createElement("h3",{className:e.icon&&i},e.title)):"";return r.createElement("div",{className:"card-demo",style:{margin:"2rem"}},r.createElement("div",{className:"card"},t,r.createElement("div",{className:"card__body"},r.createElement("p",null," ",e.children," "))))}},9205:function(e,t,n){"use strict";n.d(t,{A:function(){return l}});var r=n(7294),o="hidden_2JtY",i="iconContainer_2Rnc",a="visible_2147",c="link_Lh4h",s="clickable_3vcc",l=function(e){var t=" "+(e.active?a:o),n=c+" "+(e.link&&s);return r.createElement("div",{className:i+t},r.createElement("a",{href:e.link,className:n},e.icon||"\ud83d\ude80"))}},6649:function(e,t,n){"use strict";n.d(t,{x:function(){return i}});var r=n(7294),o="threeScene_3QXR",i=function(e){return r.createElement("iframe",{className:o,width:"100%",height:"300",key:Math.random(),src:e.link,frameBorder:"0"})}},1742:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return l},metadata:function(){return h},toc:function(){return u},default:function(){return p}});var r=n(2122),o=n(9756),i=(n(7294),n(3905)),a=(n(983),n(3878)),c=n(6649),s=["components"],l={title:"\ud83e\udd0f Picking",sidebar_position:1},h={unversionedId:"Guide/web-ifc-three/Tutorials/Picking",id:"Guide/web-ifc-three/Tutorials/Picking",isDocsHomePage:!1,title:"\ud83e\udd0f Picking",description:"Introduction",source:"@site/docs/Guide/web-ifc-three/Tutorials/Picking.mdx",sourceDirName:"Guide/web-ifc-three/Tutorials",slug:"/Guide/web-ifc-three/Tutorials/Picking",permalink:"/info/zh/docs/Guide/web-ifc-three/Tutorials/Picking",version:"current",sidebarPosition:1,frontMatter:{title:"\ud83e\udd0f Picking",sidebar_position:1},sidebar:"tutorialSidebar",previous:{title:"API",permalink:"/info/zh/docs/Guide/web-ifc-three/api"},next:{title:"\u2728 Subsets",permalink:"/info/zh/docs/Guide/web-ifc-three/Tutorials/Highlighting"}},u=[{value:"Introduction",id:"introduction",children:[{value:"Import Three.js dependencies",id:"import-threejs-dependencies",children:[]},{value:"Import three-mesh-bvh (optional)",id:"import-three-mesh-bvh-optional",children:[]},{value:"Store reference of IFC models",id:"store-reference-of-ifc-models",children:[]}]},{value:"How to do it",id:"how-to-do-it",children:[]},{value:"Next steps",id:"next-steps",children:[]}],d={toc:u};function p(e){var t=e.components,n=(0,o.Z)(e,s);return(0,i.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h2",{id:"introduction"},"Introduction"),(0,i.kt)("p",null,"\ud83d\udeb6\u200d\u2640\ufe0f\nSo far we have only loaded IFC models into the scene. That's already great, but it would be even better to be able to interact with that model, and that's precisely what we're going to do."),(0,i.kt)("h3",{id:"import-threejs-dependencies"},"Import Three.js dependencies"),(0,i.kt)("p",null,"  \u26a1\u26a1\u26a1\nBefore you can do things with objects, you need to be able to select them. This can be easily achieved with the ",(0,i.kt)("a",{parentName:"p",href:"https://threejs.org/docs/#api/en/core/Raycaster"},"Three.js Raycaster"),", which can be imported from ",(0,i.kt)("inlineCode",{parentName:"p"},"three"),"'s core library. In addition, we will import a ",(0,i.kt)("a",{parentName:"p",href:"https://threejs.org/docs/#api/en/math/Vector2"},"Vector2")," object to store the mouse position in the scene."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'import {\n  Raycaster,\n  Vector2\n} from "three";\n')),(0,i.kt)(a.r,{mdxType:"IfcAlert"},'The Raycaster allows you to shoot "beams" that hit objects in the scene and return their information.'),(0,i.kt)("h3",{id:"import-three-mesh-bvh-optional"},"Import three-mesh-bvh (optional)"),(0,i.kt)("p",null,"  \ud83d\udc69\u200d\ud83d\ude80\ud83d\ude80\nIn addition, we will import the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/gkjohnson/three-mesh-bvh"},"three-mesh-bvh library")," to make the selection of objects much more optimal. This can be installed with ",(0,i.kt)("inlineCode",{parentName:"p"},"npm i three-mesh-bvh"),". Don't worry, you don't have to learn how to use that library. Just give us these library objects and IFC.js will take care of the rest."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import {\n    acceleratedRaycast,\n    computeBoundsTree,\n    disposeBoundsTree\n} from 'three-mesh-bvh';\n\n// Sets up optimized picking\nifcLoader.ifcManager.setupThreeMeshBVH(\n                        computeBoundsTree,\n                        disposeBoundsTree,\n                        acceleratedRaycast);\n")),(0,i.kt)("h3",{id:"store-reference-of-ifc-models"},"Store reference of IFC models"),(0,i.kt)("p",null,"  \ud83c\udfe0\ud83c\udfe0\ud83c\udfe0\nBefore doing anything else, it is necessary to save a reference to the IFC models in the scene in order to select them. To do this, we just need to create an array where we store the models we load:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:"{2,6}","{2,6}":!0},'//Sets up the IFC loading\nconst ifcModels = [];\nconst ifcLoader = new IFCLoader();\nifcLoader.ifcManager.setWasmPath("../../");\nifcLoader.load("../../IFC/01.ifc", (ifcModel) => {\n  ifcModels.push(ifcModel.mesh);\n  scene.add(ifcModel.mesh)\n});\n')),(0,i.kt)("h2",{id:"how-to-do-it"},"How to do it"),(0,i.kt)("p",null,"  \ud83d\udc01\nNext we will create an instance of the Raycaster and the mouse position vector. To optimise the application, the Raycaster will only retrieve information from the first object it encounters."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"const raycaster = new Raycaster();\nraycaster.firstHitOnly = true;\nconst mouse = new Vector2();\n")),(0,i.kt)("p",null,"Now we need a function for the Raycaster to cast rays, calculating the position of the mouse on the screen. Note that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The threeCanvas object is the HTML ",(0,i.kt)("inlineCode",{parentName:"p"},"<canvas>")," element where the Three.js scene is being rendered. A reference to it can be retrieved with ",(0,i.kt)("inlineCode",{parentName:"p"},"getElementByID()"),".")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"It is necessary to specify which objects the beam collides with. In this case, it will only collide with the loaded IFC models, i.e. if there are more objects in the scene, it will ignore them."))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"function cast(event) {\n\n  // Computes the position of the mouse on the screen\n  const bounds = threeCanvas.getBoundingClientRect();\n\n  const x1 = event.clientX - bounds.left;\n  const x2 = bounds.right - bounds.left;\n  mouse.x = (x1 / x2) * 2 - 1;\n\n  const y1 = event.clientY - bounds.top;\n  const y2 = bounds.bottom - bounds.top;\n  mouse.y = -(y1 / y2) * 2 + 1;\n\n  // Places it on the camera pointing to the mouse\n  raycaster.setFromCamera(mouse, camera);\n\n  // Casts a ray\n  return raycaster.intersectObjects(ifcModels);\n}\n")),(0,i.kt)("p",null,"  \ud83d\udc53\nWe have a function that fires a ray and returns the object it collides with, but we are not doing anything with that object. Let's create a second function that gets the index of the face the ray hit and logs in the console the Express ID of the object it belongs to."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"function pick(event) {\n    const found = cast(event)[0];\n    if (found) {\n        const index = found.faceIndex;\n        const geometry = found.object.geometry;\n        const ifc = ifcLoader.ifcManager;\n        const id = ifc.getExpressId(geometry, index);\n        console.log(id);\n    }\n}\n")),(0,i.kt)(a.r,{mdxType:"IfcAlert"},"The Raycaster always returns an array of objects, even if ",(0,i.kt)("i",null,"raycaster.firstHitOnly = true;"),". In this case, the array will only contain one object that can be extracted with ",(0,i.kt)("i",null,"[0]"),"."),(0,i.kt)("p",null,"Finally, all that remains is to associate that function with an event (in this case it's a double click)."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"  threeCanvas.ondblclick = pick;\n")),(0,i.kt)("p",null,"If you have done everything right and double click on an item, you will see its Express ID in the console (you can access the console by pressing F12 or by inspecting the page)."),(0,i.kt)(c.x,{link:"https://ifcjs.github.io/hello-world/examples/web-ifc-three/picking/",mdxType:"Scene"}),(0,i.kt)("h2",{id:"next-steps"},"Next steps"),(0,i.kt)("p",null,"  \ud83c\udf89\ud83c\udf89\ud83c\udf89\nCongratulations! You now know how to get the ID of an object by clicking on it. Now we can do many things using that ID."),(0,i.kt)("p",null,"  \u2728\nHowever, it would be nice if the user could see graphically that the object has been selected. For that, let's go to the next point, where we will learn how to highlight elements."))}p.isMDXComponent=!0}}]);