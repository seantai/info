(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[6053],{3905:function(e,t,n){"use strict";n.d(t,{Zo:function(){return u},kt:function(){return h}});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),p=c(n),h=o,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||a;return n?r.createElement(m,i(i({ref:t},u),{},{components:n})):r.createElement(m,i({ref:t},u))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,i=new Array(a);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,i[1]=l;for(var c=2;c<a;c++)i[c]=n[c];return r.createElement.apply(null,i)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3878:function(e,t,n){"use strict";n.d(t,{r:function(){return i}});var r=n(7294),o="icon_1PGw",a=n(9205),i=function(e){return r.createElement("div",{className:"alert alert--primary",role:"alert",style:{margin:"2rem"}},r.createElement("div",{className:o},r.createElement(a.A,{icon:"\ud83d\udca1",active:"true"})),e.children)}},983:function(e,t,n){"use strict";n.d(t,{M:function(){return l}});var r=n(7294),o=n(9205),a="titleOffset_2I3u",i="iconContainer_1xRA",l=function(e){var t=e.title?r.createElement("div",{className:"card__header"},r.createElement("span",{className:i},e.icon&&r.createElement(o.A,{icon:e.icon,link:e.link,active:"true"})),r.createElement("h3",{className:e.icon&&a},e.title)):"";return r.createElement("div",{className:"card-demo",style:{margin:"2rem"}},r.createElement("div",{className:"card"},t,r.createElement("div",{className:"card__body"},r.createElement("p",null," ",e.children," "))))}},9205:function(e,t,n){"use strict";n.d(t,{A:function(){return c}});var r=n(7294),o="hidden_2JtY",a="iconContainer_2Rnc",i="visible_2147",l="link_Lh4h",s="clickable_3vcc",c=function(e){var t=" "+(e.active?i:o),n=l+" "+(e.link&&s);return r.createElement("div",{className:a+t},r.createElement("a",{href:e.link,className:n},e.icon||"\ud83d\ude80"))}},6649:function(e,t,n){"use strict";n.d(t,{x:function(){return a}});var r=n(7294),o="threeScene_3QXR",a=function(e){return r.createElement("iframe",{className:o,width:"100%",height:"600px",key:Math.random(),src:e.link,frameBorder:"0"})}},9090:function(e,t,n){"use strict";n.r(t),n.d(t,{frontMatter:function(){return u},metadata:function(){return d},toc:function(){return p},default:function(){return m}});var r=n(2122),o=n(9756),a=(n(7294),n(3905)),i=n(983),l=n(3878),s=n(6649),c=["components"],u={title:"\ud83d\ude80 Multithreading",sidebar_position:6},d={unversionedId:"Guide/web-ifc-three/Tutorials/AdvancedLoading",id:"Guide/web-ifc-three/Tutorials/AdvancedLoading",isDocsHomePage:!1,title:"\ud83d\ude80 Multithreading",description:"Introduction",source:"@site/docs/Guide/web-ifc-three/Tutorials/AdvancedLoading.mdx",sourceDirName:"Guide/web-ifc-three/Tutorials",slug:"/Guide/web-ifc-three/Tutorials/AdvancedLoading",permalink:"/info/docs/Guide/web-ifc-three/Tutorials/AdvancedLoading",version:"current",sidebarPosition:6,frontMatter:{title:"\ud83d\ude80 Multithreading",sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"\ud83e\udde0 Memory",permalink:"/info/docs/Guide/web-ifc-three/Tutorials/Memory"},next:{title:"Introduction",permalink:"/info/docs/Guide/web-ifc-viewer/Introduction"}},p=[{value:"Introduction",id:"introduction",children:[]},{value:"How to do it",id:"how-to-do-it",children:[{value:"Set up the webworker",id:"set-up-the-webworker",children:[]},{value:"Loading progress",id:"loading-progress",children:[]}]},{value:"Next steps",id:"next-steps",children:[]}],h={toc:p};function m(e){var t=e.components,n=(0,o.Z)(e,c);return(0,a.kt)("wrapper",(0,r.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"introduction"},"Introduction"),(0,a.kt)("p",null,"\ud83e\udd76\ud83e\udd76\ud83e\udd76\nEverything seen so far is very cool, but we have a problem: when we load a very large model ",(0,a.kt)("strong",{parentName:"p"},"the application freezes for some seconds"),". This problem also happens when we want to extract many properties from the model. Is there any way to avoid this?"),(0,a.kt)("p",null,"\ud83d\udd25\nOf course, IFC.js has foreseen this situation and has implemented ",(0,a.kt)("strong",{parentName:"p"},"multithreading"),". This means that heavy operations will be carried out in a parallel process that will not block the application, which will be updated asynchronously when the process concludes."),(0,a.kt)("p",null,"\ud83d\udc4c\nThis sounds complicated, and it is. But don't worry: we've got it all set up so you can have this in your BIM applications in a couple of lines of code."),(0,a.kt)(i.M,{mdxType:"IfcCard"},"You can find the full example of this tutorial ",(0,a.kt)("a",{href:"https://github.com/IFCjs/hello-world/tree/main/examples/web-ifc-three/multithreading"},"here"),"."),(0,a.kt)("h2",{id:"how-to-do-it"},"How to do it"),(0,a.kt)("h3",{id:"set-up-the-webworker"},"Set up the webworker"),(0,a.kt)("p",null,"\ud83d\udc69\u200d\ud83c\udfeb\nIn order to enable multithreading, the ",(0,a.kt)("strong",{parentName:"p"},"webworker")," must be configured. But what is a webworker? The webworker is the mechanism that web browsers have to be able to work with multithreading. But don't worry if you haven't heard of them before, ",(0,a.kt)("strong",{parentName:"p"},"you don't need them to use multithreading in IFC.js"),"."),(0,a.kt)("p",null,"\ud83d\udce6\ud83d\udce6\ud83d\udce6\nIf you work with ",(0,a.kt)("inlineCode",{parentName:"p"},"npm"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"yarn")," or another package manager in your project there should be a folder called ",(0,a.kt)("inlineCode",{parentName:"p"},"node_modules"),", with all the folders of the libraries your project is using. In ",(0,a.kt)("inlineCode",{parentName:"p"},"node_modules/web-ifc-three")," you will find the two files needed to use webworkers: ",(0,a.kt)("inlineCode",{parentName:"p"},"IFCWorker.js")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"IFCWorker.js.map"),"."),(0,a.kt)(i.M,{mdxType:"IfcCard"},"You have to copy these two files to a directory in your project that will be served with the final application. This varies depending on the technology you are using (vanilla JS, React, Angular, etc). You can use the same directory you are using for the wasm files."),(0,a.kt)("p",null,"\ud83c\udf0d\nThen you have to specify where this file is located, in the same way as with the wasm file. This can be done like this:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"async function setUpMultiThreading() {\n    const manager = ifcLoader.ifcManager;\n    // These paths depend on how you structure your project\n    await manager.useWebWorkers(true, 'IFCWorker.js');\n    await manager.setWasmPath('../../../');\n}\n\nsetUpMultiThreading();\n")),(0,a.kt)("p",null,"\ud83e\udd76\u26d4\nAnd, voi l\xe1! Believe it or not, you have already enabled multithreading in your project. If you now try to load a file in your application or try to get many properties at once, you will see that ",(0,a.kt)("strong",{parentName:"p"},"the application does not freeze"),"."),(0,a.kt)(l.r,{mdxType:"IfcAlert"},"Note that if you activate the webworker, the path to the wasm files must be relative to the webworker."),(0,a.kt)("p",null,"\ud83e\udd16\u2753\ud83d\udcda\nKeep in mind that ",(0,a.kt)("strong",{parentName:"p"},"the version of the webworker has to match the version of the library")," you are using. This means that if you update the version of ",(0,a.kt)("inlineCode",{parentName:"p"},"web-ifc-three")," in the future, you'll need to copy these files again. You can automate this using a command-line library to copy files like ",(0,a.kt)("inlineCode",{parentName:"p"},"cpy"),"."),(0,a.kt)("h3",{id:"loading-progress"},"Loading progress"),(0,a.kt)("p",null,"\ud83d\udd25\nUsing multithreading in your BIM application has numerous advantages. The most immediate is that we can now ",(0,a.kt)("strong",{parentName:"p"},"show the user the loading progress of a model"),". First we'll add a simple HTML message to show the progress:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-html"},'div id="text-container">\n   <p>Progress:</p><p id="progress-text">0</p><p>%</p>\n/div>\n')),(0,a.kt)("p",null,"\u2728\u2728\u2728\nNext we are going to ",(0,a.kt)("strong",{parentName:"p"},"link this HTML element to the model load event"),". This can be easily done with the ",(0,a.kt)("inlineCode",{parentName:"p"},"setOnProgress()")," method. Let's also apply some basic math to ",(0,a.kt)("strong",{parentName:"p"},"convert progress into a percentage"),"."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"function setupProgressNotification() {\n    const text = document.getElementById('progress-text');\n    ifcLoader.ifcManager.setOnProgress((event) => {\n      const percent = event.loaded / event.total * 100;\n        const result = Math.trunc(percent);\n        text.innerText = result.toString();\n    });\n}\n\nsetupProgressNotification();\n")),(0,a.kt)("p",null,"\ud83c\udf08\nIf you have done everything correctly, we should be able to see the following viewer. If you try to load an IFC model, not only you will see that ",(0,a.kt)("strong",{parentName:"p"},"the loading process does not block the 3D view"),", but the ",(0,a.kt)("strong",{parentName:"p"},"html text shows the loading progress in real time"),"."),(0,a.kt)(s.x,{link:"https://ifcjs.github.io/hello-world/examples/web-ifc-three/multithreading/index.html",mdxType:"Scene"}),(0,a.kt)("h2",{id:"next-steps"},"Next steps"),(0,a.kt)("p",null,"\ud83c\udf89\ud83c\udf89\ud83c\udf89\nCongratulations! You can now ",(0,a.kt)("strong",{parentName:"p"},"create multithreaded BIM applications")," that never freeze."),(0,a.kt)("p",null,"\ud83d\ude0e\nYou are now familiar with some advanced tools of IFC.js, but there's much more to learn. In later tutorials we will see how to not only read, but also ",(0,a.kt)("strong",{parentName:"p"},"edit and create IFC files"),"."))}m.isMDXComponent=!0}}]);